<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowFocus - 专业番茄钟</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .theme-transition {
            transition: all 0.3s ease;
        }
        
        .progress-ring {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        
        .progress-ring-circle {
            transition: stroke-dashoffset 0.35s;
            stroke-linecap: round;
        }
        
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark .glass-effect {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
        
        @keyframes pulse-ring {
            0% {
                transform: scale(0.95);
                opacity: 1;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.5;
            }
            100% {
                transform: scale(0.95);
                opacity: 1;
            }
        }
        
        .pulse-animation {
            animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="theme-transition bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
    <div id="app" class="min-h-screen">
        <!-- Header -->
        <header class="theme-transition bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-clock text-white"></i>
                        </div>
                        <h1 class="text-xl font-bold">FlowFocus</h1>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <!-- Theme Toggle -->
                        <button onclick="toggleTheme()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 theme-transition">
                            <i class="fas fa-sun text-yellow-500 dark:hidden"></i>
                            <i class="fas fa-moon text-blue-400 hidden dark:inline"></i>
                        </button>
                        
                        <!-- Settings -->
                        <button onclick="openSettings()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 theme-transition">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Timer Section -->
                <div class="lg:col-span-2">
                    <div class="theme-transition bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8">
                        <div class="flex flex-col items-center">
                            <!-- Timer Display -->
                            <div class="relative w-64 h-64 mb-8">
                                <svg class="progress-ring w-full h-full">
                                    <circle
                                        cx="128"
                                        cy="128"
                                        r="120"
                                        stroke="currentColor"
                                        stroke-width="8"
                                        fill="none"
                                        class="text-gray-200 dark:text-gray-700"
                                    />
                                    <circle
                                        id="progressCircle"
                                        cx="128"
                                        cy="128"
                                        r="120"
                                        stroke="currentColor"
                                        stroke-width="8"
                                        fill="none"
                                        class="progress-ring-circle"
                                        style="stroke-dasharray: 754; stroke-dashoffset: 754;"
                                    />
                                </svg>
                                <div class="absolute inset-0 flex flex-col items-center justify-center">
                                    <div id="timerDisplay" class="text-5xl font-bold mb-2">25:00</div>
                                    <div id="sessionType" class="text-lg font-medium text-gray-500 dark:text-gray-400">工作时间</div>
                                </div>
                            </div>
                            
                            <!-- Control Buttons -->
                            <div class="flex space-x-4 mb-8">
                                <button onclick="toggleTimer()" id="startBtn" class="px-8 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-semibold hover:shadow-lg transform hover:scale-105 transition-all duration-200">
                                    <i class="fas fa-play mr-2"></i>开始
                                </button>
                                <button onclick="resetTimer()" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 rounded-xl font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-all duration-200">
                                    <i class="fas fa-redo mr-2"></i>重置
                                </button>
                                <button onclick="skipSession()" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 rounded-xl font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-all duration-200">
                                    <i class="fas fa-forward mr-2"></i>跳过
                                </button>
                            </div>
                            
                            <!-- Session Info -->
                            <div class="grid grid-cols-3 gap-4 w-full max-w-md">
                                <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
                                    <div class="text-2xl font-bold text-purple-500" id="completedPomodoros">0</div>
                                    <div class="text-sm text-gray-500 dark:text-gray-400">已完成</div>
                                </div>
                                <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
                                    <div class="text-2xl font-bold text-green-500" id="totalFocusTime">0</div>
                                    <div class="text-sm text-gray-500 dark:text-gray-400">专注分钟</div>
                                </div>
                                <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
                                    <div class="text-2xl font-bold text-blue-500" id="currentStreak">0</div>
                                    <div class="text-sm text-gray-500 dark:text-gray-400">连续天数</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tasks Section -->
                <div class="lg:col-span-1">
                    <div class="theme-transition bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-bold">今日任务</h2>
                            <button onclick="addTask()" class="p-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        
                        <div id="taskList" class="space-y-3 max-h-96 overflow-y-auto custom-scrollbar">
                            <!-- Tasks will be added here -->
                        </div>
                        
                        <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500 dark:text-gray-400">今日进度</span>
                                <span class="font-semibold"><span id="taskProgress">0</span>%</span>
                            </div>
                            <div class="mt-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                <div id="taskProgressBar" class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Statistics Section -->
            <div class="mt-8">
                <div class="theme-transition bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6">
                    <h2 class="text-xl font-bold mb-6">本周统计</h2>
                    <div class="grid grid-cols-7 gap-2">
                        <div class="text-center">
                            <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">周一</div>
                            <div class="h-20 bg-gray-100 dark:bg-gray-700 rounded-lg relative overflow-hidden">
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-purple-500 to-purple-400" style="height: 60%"></div>
                            </div>
                            <div class="text-xs mt-1 font-semibold">4h</div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">周二</div>
                            <div class="h-20 bg-gray-100 dark:bg-gray-700 rounded-lg relative overflow-hidden">
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-purple-500 to-purple-400" style="height: 80%"></div>
                            </div>
                            <div class="text-xs mt-1 font-semibold">6h</div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">周三</div>
                            <div class="h-20 bg-gray-100 dark:bg-gray-700 rounded-lg relative overflow-hidden">
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-purple-500 to-purple-400" style="height: 40%"></div>
                            </div>
                            <div class="text-xs mt-1 font-semibold">3h</div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">周四</div>
                            <div class="h-20 bg-gray-100 dark:bg-gray-700 rounded-lg relative overflow-hidden">
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-purple-500 to-purple-400" style="height: 90%"></div>
                            </div>
                            <div class="text-xs mt-1 font-semibold">7h</div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">周五</div>
                            <div class="h-20 bg-gray-100 dark:bg-gray-700 rounded-lg relative overflow-hidden">
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-purple-500 to-purple-400" style="height: 70%"></div>
                            </div>
                            <div class="text-xs mt-1 font-semibold">5h</div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">周六</div>
                            <div class="h-20 bg-gray-100 dark:bg-gray-700 rounded-lg relative overflow-hidden">
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-purple-500 to-purple-400" style="height: 30%"></div>
                            </div>
                            <div class="text-xs mt-1 font-semibold">2h</div>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">周日</div>
                            <div class="h-20 bg-gray-100 dark:bg-gray-700 rounded-lg relative overflow-hidden">
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-purple-500 to-purple-400" style="height: 0%"></div>
                            </div>
                            <div class="text-xs mt-1 font-semibold">0h</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="theme-transition bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">设置</h3>
                <button onclick="closeSettings()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <!-- Timer Settings -->
                <div>
                    <h4 class="font-semibold mb-3">计时器设置</h4>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <label class="text-sm text-gray-600 dark:text-gray-400">工作时间（分钟）</label>
                            <input type="number" id="workDuration" value="25" min="1" max="60" class="w-20 px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-center">
                        </div>
                        <div class="flex justify-between items-center">
                            <label class="text-sm text-gray-600 dark:text-gray-400">短休息（分钟）</label>
                            <input type="number" id="shortBreakDuration" value="5" min="1" max="30" class="w-20 px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-center">
                        </div>
                        <div class="flex justify-between items-center">
                            <label class="text-sm text-gray-600 dark:text-gray-400">长休息（分钟）</label>
                            <input type="number" id="longBreakDuration" value="15" min="1" max="60" class="w-20 px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-center">
                        </div>
                    </div>
                </div>
                
                <!-- Theme Color -->
                <div>
                    <h4 class="font-semibold mb-3">主题颜色</h4>
                    <div class="grid grid-cols-6 gap-2">
                        <button onclick="setThemeColor('purple')" class="w-10 h-10 bg-purple-500 rounded-lg hover:scale-110 transition-transform"></button>
                        <button onclick="setThemeColor('blue')" class="w-10 h-10 bg-blue-500 rounded-lg hover:scale-110 transition-transform"></button>
                        <button onclick="setThemeColor('green')" class="w-10 h-10 bg-green-500 rounded-lg hover:scale-110 transition-transform"></button>
                        <button onclick="setThemeColor('red')" class="w-10 h-10 bg-red-500 rounded-lg hover:scale-110 transition-transform"></button>
                        <button onclick="setThemeColor('yellow')" class="w-10 h-10 bg-yellow-500 rounded-lg hover:scale-110 transition-transform"></button>
                        <button onclick="setThemeColor('indigo')" class="w-10 h-10 bg-indigo-500 rounded-lg hover:scale-110 transition-transform"></button>
                    </div>
                </div>
                
                <!-- Save Button -->
                <button onclick="saveSettings()" class="w-full py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-semibold hover:shadow-lg transform hover:scale-105 transition-all duration-200">
                    保存设置
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // State management
        let state = {
            isRunning: false,
            isPaused: false,
            currentSession: 'work', // work, shortBreak, longBreak
            timeLeft: 25 * 60, // in seconds
            completedPomodoros: 0,
            totalFocusTime: 0,
            currentStreak: 0,
            tasks: [],
            settings: {
                workDuration: 25,
                shortBreakDuration: 5,
                longBreakDuration: 15,
                themeColor: 'purple',
                isDarkMode: false
            }
        };
        
        let timerInterval = null;
        let themeColor = 'purple';
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            updateDisplay();
            updateProgressRing();
            loadTasks();
            updateTaskProgress();
            
            // Check for dark mode preference
            if (localStorage.getItem('darkMode') === 'true' || 
                (!localStorage.getItem('darkMode') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                state.settings.isDarkMode = true;
            }
        });
        
        // Timer functions
        function toggleTimer() {
            if (state.isRunning) {
                pauseTimer();
            } else {
                startTimer();
            }
        }
        
        function startTimer() {
            state.isRunning = true;
            state.isPaused = false;
            updateStartButton();
            
            timerInterval = setInterval(() => {
                if (state.timeLeft > 0) {
                    state.timeLeft--;
                    updateDisplay();
                    updateProgressRing();
                } else {
                    completeSession();
                }
            }, 1000);
        }
        
        function pauseTimer() {
            state.isRunning = false;
            state.isPaused = true;
            clearInterval(timerInterval);
            updateStartButton();
        }
        
        function resetTimer() {
            state.isRunning = false;
            state.isPaused = false;
            clearInterval(timerInterval);
            
            if (state.currentSession === 'work') {
                state.timeLeft = state.settings.workDuration * 60;
            } else if (state.currentSession === 'shortBreak') {
                state.timeLeft = state.settings.shortBreakDuration * 60;
            } else {
                state.timeLeft = state.settings.longBreakDuration * 60;
            }
            
            updateDisplay();
            updateProgressRing();
            updateStartButton();
        }
        
        function skipSession() {
            completeSession();
        }
        
        function completeSession() {
            clearInterval(timerInterval);
            state.isRunning = false;
            
            if (state.currentSession === 'work') {
                state.completedPomodoros++;
                state.totalFocusTime += state.settings.workDuration;
                
                // Determine next session
                if (state.completedPomodoros % 4 === 0) {
                    state.currentSession = 'longBreak';
                    state.timeLeft = state.settings.longBreakDuration * 60;
                } else {
                    state.currentSession = 'shortBreak';
                    state.timeLeft = state.settings.shortBreakDuration * 60;
                }
            } else {
                state.currentSession = 'work';
                state.timeLeft = state.settings.workDuration * 60;
            }
            
            updateDisplay();
            updateProgressRing();
            updateStartButton();
            updateStats();
            
            // Show completion notification
            showNotification();
        }
        
        function updateDisplay() {
            const minutes = Math.floor(state.timeLeft / 60);
            const seconds = state.timeLeft % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const sessionType = document.getElementById('sessionType');
            if (state.currentSession === 'work') {
                sessionType.textContent = '工作时间';
                sessionType.className = 'text-lg font-medium text-purple-500';
            } else if (state.currentSession === 'shortBreak') {
                sessionType.textContent = '短休息';
                sessionType.className = 'text-lg font-medium text-green-500';
            } else {
                sessionType.textContent = '长休息';
                sessionType.className = 'text-lg font-medium text-blue-500';
            }
        }
        
        function updateProgressRing() {
            const circle = document.getElementById('progressCircle');
            const totalTime = state.currentSession === 'work' ? state.settings.workDuration * 60 :
                            state.currentSession === 'shortBreak' ? state.settings.shortBreakDuration * 60 :
                            state.settings.longBreakDuration * 60;
            
            const progress = (totalTime - state.timeLeft) / totalTime;
            const circumference = 2 * Math.PI * 120;
            const offset = circumference - (progress * circumference);
            
            circle.style.strokeDashoffset = offset;
            
            // Update color based on session
            if (state.currentSession === 'work') {
                circle.classList.add('text-purple-500');
                circle.classList.remove('text-green-500', 'text-blue-500');
            } else if (state.currentSession === 'shortBreak') {
                circle.classList.add('text-green-500');
                circle.classList.remove('text-purple-500', 'text-blue-500');
            } else {
                circle.classList.add('text-blue-500');
                circle.classList.remove('text-purple-500', 'text-green-500');
            }
        }
        
        function updateStartButton() {
            const btn = document.getElementById('startBtn');
            if (state.isRunning) {
                btn.innerHTML = '<i class="fas fa-pause mr-2"></i>暂停';
            } else if (state.isPaused) {
                btn.innerHTML = '<i class="fas fa-play mr-2"></i>继续';
            } else {
                btn.innerHTML = '<i class="fas fa-play mr-2"></i>开始';
            }
        }
        
        function updateStats() {
            document.getElementById('completedPomodoros').textContent = state.completedPomodoros;
            document.getElementById('totalFocusTime').textContent = state.totalFocusTime;
            document.getElementById('currentStreak').textContent = state.currentStreak;
        }
        
        function showNotification() {
            // Create a subtle notification
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 transform translate-x-full transition-transform duration-300 z-50';
            notification.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-check text-white"></i>
                    </div>
                    <div>
                        <div class="font-semibold">完成！</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400">
                            ${state.currentSession === 'work' ? '休息一下吧' : '继续加油！'}
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // Theme functions
        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            state.settings.isDarkMode = document.documentElement.classList.contains('dark');
            localStorage.setItem('darkMode', state.settings.isDarkMode);
        }
        
        function setThemeColor(color) {
            themeColor = color;
            state.settings.themeColor = color;
            
            // Update all gradient elements
            const gradients = document.querySelectorAll('.bg-gradient-to-r');
            gradients.forEach(el => {
                el.className = el.className.replace(/from-\w+-500 to-\w+-500/g, `from-${color}-500 to-${color}-500`);
            });
            
            // Update progress bars
            const progressBars = document.querySelectorAll('.bg-gradient-to-t');
            progressBars.forEach(el => {
                el.className = el.className.replace(/from-\w+-500 to-\w+-400/g, `from-${color}-500 to-${color}-400`);
            });
        }
        
        // Settings functions
        function openSettings() {
            document.getElementById('settingsModal').classList.remove('hidden');
            document.getElementById('workDuration').value = state.settings.workDuration;
            document.getElementById('shortBreakDuration').value = state.settings.shortBreakDuration;
            document.getElementById('longBreakDuration').value = state.settings.longBreakDuration;
        }
        
        function closeSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
        }
        
        function saveSettings() {
            state.settings.workDuration = parseInt(document.getElementById('workDuration').value);
            state.settings.shortBreakDuration = parseInt(document.getElementById('shortBreakDuration').value);
            state.settings.longBreakDuration = parseInt(document.getElementById('longBreakDuration').value);
            
            localStorage.setItem('pomodoroSettings', JSON.stringify(state.settings));
            closeSettings();
            
            // Reset timer with new settings
            resetTimer();
        }
        
        function loadSettings() {
            const saved = localStorage.getItem('pomodoroSettings');
            if (saved) {
                state.settings = JSON.parse(saved);
                setThemeColor(state.settings.themeColor);
            }
        }
        
        // Task functions
        function addTask() {
            const taskName = prompt('输入任务名称：');
            if (taskName && taskName.trim()) {
                const task = {
                    id: Date.now(),
                    name: taskName.trim(),
                    completed: false,
                    pomodoros: 0
                };
                state.tasks.push(task);
                saveTasks();
                renderTasks();
                updateTaskProgress();
            }
        }
        
        function toggleTask(id) {
            const task = state.tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                saveTasks();
                renderTasks();
                updateTaskProgress();
            }
        }
        
        function deleteTask(id) {
            state.tasks = state.tasks.filter(t => t.id !== id);
            saveTasks();
            renderTasks();
            updateTaskProgress();
        }
        
        function renderTasks() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';
            
            if (state.tasks.length === 0) {
                taskList.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400 py-8">暂无任务</p>';
                return;
            }
            
            state.tasks.forEach(task => {
                const taskEl = document.createElement('div');
                taskEl.className = `p-4 rounded-lg border transition-all duration-200 ${
                    task.completed 
                        ? 'bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600 opacity-60' 
                        : 'bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:shadow-md'
                }`;
                
                taskEl.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3 flex-1">
                            <button onclick="toggleTask(${task.id})" class="w-5 h-5 rounded border-2 ${
                                task.completed 
                                    ? 'bg-purple-500 border-purple-500' 
                                    : 'border-gray-300 dark:border-gray-600 hover:border-purple-500'
                            } transition-colors">
                                ${task.completed ? '<i class="fas fa-check text-white text-xs"></i>' : ''}
                            </button>
                            <span class="${task.completed ? 'line-through' : ''}">${task.name}</span>
                        </div>
                        <button onclick="deleteTask(${task.id})" class="p-1 text-gray-400 hover:text-red-500 transition-colors">
                            <i class="fas fa-trash text-sm"></i>
                        </button>
                    </div>
                    ${task.pomodoros > 0 ? `
                        <div class="mt-2 ml-8 flex items-center space-x-1">
                            ${Array(task.pomodoros).fill('').map(() => 
                                '<div class="w-2 h-2 bg-purple-500 rounded-full"></div>'
                            ).join('')}
                        </div>
                    ` : ''}
                `;
                
                taskList.appendChild(taskEl);
            });
        }
        
        function updateTaskProgress() {
            const total = state.tasks.length;
            const completed = state.tasks.filter(t => t.completed).length;
            const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            document.getElementById('taskProgress').textContent = progress;
            document.getElementById('taskProgressBar').style.width = `${progress}%`;
        }
        
        function saveTasks() {
            localStorage.setItem('pomodoroTasks', JSON.stringify(state.tasks));
        }
        
        function loadTasks() {
            const saved = localStorage.getItem('pomodoroTasks');
            if (saved) {
                state.tasks = JSON.parse(saved);
                renderTasks();
            }
        }
        
        // Close modal on outside click
        document.getElementById('settingsModal').addEventListener('click', (e) => {
            if (e.target.id === 'settingsModal') {
                closeSettings();
            }
        });
    </script>
</body>
</html>